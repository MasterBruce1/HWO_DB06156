GPIO.setmode(GPIO.BCM)
for sensor, pin in sensors.items():
    GPIO.setup(pin, GPIO.IN, pull_up_down=GPIO.PUD_DOWN)

# Check sensor states
def check_sensors():
    return {sensor: GPIO.input(pin) for sensor, pin in sensors.items()}

# Stop conditions based on target sensor states
def stop_condition_all_in_position(): #no.1 sensor
    states = check_sensors()
    return all(states.values())  # All sensors are "IN POSITION"

def stop_condition_sensor4(): #no.4sensor
    states = check_sensors()
    return states["sensor4"] and not any(states[sensor] for sensor in ["sensor1", "sensor2", "sensor3"])

def stop_condition_sensor34(): #no.3 sensor
    states = check_sensors()
    return states["sensor3"] and states["sensor4"] and not states["sensor1"] and not states["sensor2"]

def stop_condition_sensor234(): #no2. sensor
    states = check_sensors()
    return states["sensor2"] and states["sensor3"] and states["sensor4"] and not states["sensor1"]

# Main loop
def main():
    setup()
    enable_driver()
    try:
        print("Moving clockwise until all sensors are IN POSITION...")
        move_continuous(speed=200.0, direction='counterclockwise', stop_condition=stop_condition_all_in_position)
        current_command = 1
        
        while True:
            
            next_command = input("Enter command (1: Sensor4, 2: Sensor34, 3: Sensor234, 4: All): ").strip()
            if next_command not in ["1", "2", "3", "4"]:
                print("Invalid input. Please enter 1, 2, 3, or 4.")
                continue
            next_command = int(next_command)
            
            if next_command > current_command:
                print(f"Moving counterclockwise to reach state {next_command}...")
                if next_command == 2:
                    move(100, speed=200, direction='counterclockwise')
                    move_continuous(speed=200.0, direction='counterclockwise', stop_condition=stop_condition_sensor234)
                elif next_command == 3:
                    move(100, speed=200, direction='counterclockwise')
                    move_continuous(speed=200.0, direction='counterclockwise', stop_condition=stop_condition_sensor34)
                elif next_command == 4:
                    move(100, speed=200, direction='counterclockwise')
                    move_continuous(speed=200.0, direction='counterclockwise', stop_condition=stop_condition_sensor4)
            elif next_command < current_command:
                print(f"Moving clockwise to reach state {next_command}...")
                if next_command == 4:
                    move(100, speed=200, direction='clockwise')
                    move_continuous(speed=200.0, direction='clockwise', stop_condition=stop_condition_sensor4)
                elif next_command == 3:
                    move(100, speed=200, direction='clockwise')
                    move_continuous(speed=200.0, direction='clockwise', stop_condition=stop_condition_sensor34)
                elif next_command == 2:
                    move(100, speed=200, direction='clockwise')
                    move_continuous(speed=200.0, direction='clockwise', stop_condition=stop_condition_sensor234)
                elif next_command == 1:
                    move(100, speed=200, direction='clockwise')
                    move_continuous(speed=200.0, direction='clockwise', stop_condition=stop_condition_all_in_position)
            else:
                print("Staying in position. No movement required.")

            # æ›´æ–°å½“å‰å‘½ä»¤çŠ¶æ€
            current_command = next_command

    except KeyboardInterrupt:
        print("Program terminated.")
    finally:
        disable_driver()
        GPIO.cleanup()

if __name__ == "__main__":
    main()

